<%= flash[:notice] %>
<h2 class="text-center page-title"><%=@yt_info["title"]%></h2>

<p class="text-center">
    <% if session[:userinfo].nil? %>
        <%= link_to "Login to favorite this video", '/auth/auth0', method: :post %>
    <% else %>
        <%= link_to "Favorite this video", "/video/#{@video.id}/favorite", method: :post, data: { turbolinks: 'false' } %>
    <% end %>
</p>

<div>
  <div class="text-center">
    <div id="player"></div>
  </div>

  <div>
  <p class="text-center"><%= @all_tracks.size %> description track(s) found!</p>
  <div class="table-list text-center">
    <% @all_tracks.each do |dtrack| %>
    <div class="table-list-item">
      <%= link_to "#{LanguageList::LanguageInfo.find(dtrack.lang).name} descriptions by #{dtrack.author.username}", "/video/#{params[:id]}/play/#{dtrack["id"]}", :class => "#{'disabled' unless dtrack.published}", data: { turbolinks: 'false' } %>, <%= dtrack.number_of_votes %> votes
      <% if not session[:userinfo].nil? and session[:userinfo]["nickname"] ==  dtrack.author.username %>
        <%= link_to "Edit", "/video/#{params[:id]}/describe/#{dtrack.id}", :class => 'btn btn-primary', data: { turbolinks: 'false' } %>
        <%= link_to "Delete", "/video/#{params[:id]}/delete/#{dtrack.id}", :class => 'btn btn-danger', data: { turbolinks: 'false' } %>
      <% end %>
    </div>
    <% end %>
  </div>
  </div>
</div>

<br>

<h3>Create new description track</h3>

<%= form_tag "/video/#{@video.id}/describe", :method => :get do %>
  <%= csrf_meta_tags %>
  <%= select_tag :lang, raw(@langs) %>
  <%= submit_tag 'Create new track!', :class => 'btn btn-primary' %>
<% end %>

<br>

<h3>Video Info</h3>
<%= @yt_info["description"].gsub(/\n/, '<br/>').html_safe %>

<script>
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
    function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '390',
        width: '640',
        videoId: '<%=@video.yt_video_id%>',
    });
    }
</script>